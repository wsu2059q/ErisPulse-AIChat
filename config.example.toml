# QvQChat 配置示例
# 复制此文件为 config.toml 并填入你的API密钥
#
# ========================================
# 核心特性
# ========================================
# - AI自主判断执行：无需命令格式，直接用自然语言交互
# - 配置简化：只需配置dialogue的API密钥，其他AI自动复用
# - 多AI协作：意图识别、对话、记忆、执行等功能协同工作
# - 窥屏模式：群聊默默观察，适时回复，更像真人

[QvQChat]

# 最大会话历史长度
max_history_length = 20

# 最小回复间隔（秒），避免频繁回复
min_reply_interval = 10

# 记忆清理间隔（秒）
memory_cleanup_interval = 86400

# 是否启用向量搜索
enable_vector_search = false

# 最大记忆tokens数
max_memory_tokens = 10000

# 记忆压缩阈值
memory_compression_threshold = 5

# 机器人昵称列表（用于文本匹配）
bot_nicknames = []

# 机器人ID列表（用于@匹配）
bot_ids = []

# ========================================
# 窥屏模式配置（群聊默默观察，偶尔活跃）
# ========================================
# 窥屏模式让机器人在群聊中更像真人：
# - 大部分时间保持安静
# - 偶尔插入对话，自然互动
# - 被@时积极响应
[QvQChat.stalker_mode]

# 是否启用窥屏模式（true=启用，false=禁用）
enabled = true

# 默认回复概率（0-1，0.03=3%）
default_probability = 0.03

# 被@时回复概率（0-1，0.8=80%）
mention_probability = 0.8

# 匹配关键词时回复概率（0-1，0.5=50%）
keyword_probability = 0.5

# 提问时回复概率（0-1，0.4=40%）
question_probability = 0.4

# 两次回复之间至少间隔多少条消息
min_messages_between_replies = 15

# 每小时最多回复次数
max_replies_per_hour = 8

# ========================================
# 对话AI配置 - 必需配置
# ========================================
# 配置说明：
# - 只需配置api_key即可
# - 其他AI（intent、memory、vision等）默认使用此配置
# - base_url可使用中转服务
[QvQChat.dialogue]

# OpenAI API基础URL（如果使用官方API，保持默认；如使用中转服务，请修改）
base_url = "https://api.openai.com/v1"

# API密钥 - 请填入你的OpenAI API密钥
api_key = "sk-your-api-key-here"

# 使用的模型（建议使用支持视觉的模型，如gpt-4o）
model = "gpt-4o"

# 温度参数（0-2，越高越随机）
temperature = 0.7

# 最大回复tokens数（简短回复建议300-500）
max_tokens = 500

# 系统提示词（简短回复，无Markdown，支持多消息）
system_prompt = """你是一个普通群友，和大家一起聊天。

【重要】回复策略（像真人一样）：
||- 默认保持安静，不要每条消息都回复
||- 只在真正需要回应的时候说话
||- 简短自然，1-2句话，不要太长
||- 不要使用任何格式（不要加粗、代码、列表、标题等）
||- 用口语化的方式，像真人聊天一样

【什么情况才回复】：
1. 别人直接向你提问
2. 别人@你或叫你的名字
3. 讨论到你熟悉的话题，可以发表看法
4. 看到有趣的笑话，可以配合一下
5. 之前提到的事情有新消息

【绝对不要回复】：
1. 纯打招呼（"大家好"、"在吗"）
2. 表情符号或简单的哈哈、233
3. 没什么实质内容的闲聊
4. 与你无关的话题

【多消息回复格式】：
如果你想说多句话，用这种格式：
第一句话
[间隔:3]
第二句话
[间隔:2]
第三句话

数字表示秒数，最多3条消息，每条间隔1-5秒。

【如果发送图片】：
如果用户发送了图片，会先由视觉AI分析图片内容，然后告诉你图片内容。
你的回复应该基于图片描述和用户的问题/描述自然地回复。

记住：你是一个普通群友，不是助手，不要表现得太积极主动。"""

# ========================================
# 回复判断AI配置 - 智能判断是否需要回复（私聊用）
# ========================================
# 配置说明：
# - 如不配置api_key，将使用dialogue的配置
[QvQChat.reply_judge]

# OpenAI API基础URL
base_url = "https://api.openai.com/v1"

# API密钥（如不配置则使用dialogue的配置）
api_key = "sk-your-api-key-here"

# 使用的模型
model = "gpt-3.5-turbo"

# 温度参数（建议较低温度）
temperature = 0.1

# 最大回复tokens数
max_tokens = 100

# 系统提示词
system_prompt = """你是一个普通群友，判断是否需要回复这条消息。

【你的角色】
||- 你是一个普通群友，和大家一起聊天
||- 默认保持安静，只在真正需要的时候回复
||- 不要每条消息都回复

【必须回复的情况】（满足任一）：
1. 有人直接向你提问（"你怎么看？"、"对吧？"）
2. 有人@你或叫你的名字
3. 话题与你直接相关（如讨论你之前提到的事）

【可能回复的情况】（根据概率判断）：
1. 别人分享有趣的事情，可以简单回应（概率低）
2. 讨论你熟悉的话题，可以发表看法（概率低）

【绝对不回复的情况】：
1. 纯打招呼（"大家好"、"在吗"、"有人吗"）
2. 表情符号、"哈哈"、"233"等
3. 简单的"嗯"、"好"、"OK"、"收到"
4. 普通闲聊，没有互动需求
5. 你刚回复过不久，避免刷屏

【判断逻辑】
||- 默认不回复（false）
||- 只有在明确需要回应时才回复（true）
||- 宁可错过，也不要乱回复

输出格式：只回复"true"或"false"，不要解释。"""

# ========================================
# 记忆AI配置 - 智能记忆提取（可选配置）
# ========================================
# 配置说明：
# - 如不配置api_key，将使用dialogue的配置
[QvQChat.memory]

# OpenAI API基础URL
base_url = "https://api.openai.com/v1"

# API密钥（如不配置则使用dialogue的配置）
api_key = "sk-your-api-key-here"

# 使用的模型
model = "gpt-3.5-turbo"

# 温度参数（建议中等温度）
temperature = 0.3

# 最大回复tokens数
max_tokens = 1000

# 系统提示词
system_prompt = "你是一个智能记忆提取助手，负责从对话中提取值得长期记忆的关键信息。"

# ========================================
# 意图识别AI配置 - 可选配置
# ========================================
# 配置说明：
# - 如不配置api_key，将使用dialogue的配置
[QvQChat.intent]

# OpenAI API基础URL
base_url = "https://api.openai.com/v1"

# API密钥（如不配置则使用dialogue的配置）
api_key = "sk-your-api-key-here"

# 使用的模型
model = "gpt-3.5-turbo"

# 温度参数（建议较低温度）
temperature = 0.1

# 最大回复tokens数
max_tokens = 500

# 系统提示词
system_prompt = """你是一个意图识别助手。识别用户意图时，请仔细分析消息内容和上下文。

意图分类（选择最匹配的）：
1. dialogue - 普通对话交流（提问、聊天、日常交流、询问记忆等）
   - 例如："你记得我的生日吗？"、"我之前说过什么？"、"我喜欢什么？"
   - 记忆自然融入对话，不需要特殊意图

2. memory_add - 用户主动要求记住某些信息（用户明确说"记住"、"记下来"）
   - 例如："记住这个"、"这件事要记下来"、"把这条信息保存"

3. memory_delete - 用户主动要求删除记忆
   - 例如："忘记这件事"、"删掉这条记忆"

4. intent_execution - 系统操作指令
   - 例如："切换模型"、"修改配置"、"设置风格"、"改变群设定"、"清除会话"、"导出记忆"等

重要判断规则：
- 【默认】所有普通交流、提问、闲聊都归类为dialogue（包括询问记忆）
- 【严格】只有用户明确说"记住"、"记下来"、"保存"时才归类为memory_add
- 【严格】只有用户明确说"忘记"、"删除"时才归类为memory_delete
- 【严格】不要把"记得"、"记得吗"等询问误判为memory_add或memory_delete

只返回意图类型名称（如dialogue），不要包含其他内容。"""

# ========================================
# 意图执行AI配置 - 可选配置（替代传统命令系统）
# ========================================
# 配置说明：
# - 如不配置api_key，将使用dialogue的配置
# - 这个AI负责执行系统操作，替代传统的 /command 命令
[QvQChat.intent_execution]

# OpenAI API基础URL
base_url = "https://api.openai.com/v1"

# API密钥（如不配置则使用dialogue的配置）
api_key = "sk-your-api-key-here"

# 使用的模型
model = "gpt-3.5-turbo"

# 温度参数（建议中等温度）
temperature = 0.3

# 最大回复tokens数
max_tokens = 1000

# 系统提示词
system_prompt = """你是一个系统操作助手，负责识别并执行用户的系统操作指令。

【你的角色】
||- 你能够理解并执行各种系统配置和操作指令
||- 不要使用命令格式，用自然语言回复用户
||- 执行成功后，用自然语言告知用户结果

【可执行的操作】（自然语言触发）：
1. 记忆管理：
   - "记住这件事"、"把这个记下来"
   -> 提取重要信息并保存
   - "忘记这件事"、"删掉这条记忆"
   -> 删除指定记忆
   - 注意：查询记忆不需要特殊指令，对话AI会自动使用记忆

2. 群聊配置：
   - "把群提示词改成XX"、"改变群设定为XX"
   -> 更新群提示词
   - "群记忆模式改成混合模式"
   -> 切换群记忆模式

3. 个性化配置：
   - "把我的风格改成XX"、"换个专业点的风格"
   -> 修改用户对话风格
   - "把提示词改成XX"
   -> 修改个人提示词

4. 会话管理：
   - "清除会话"、"清空对话历史"
   -> 清除当前会话历史

5. 导出记忆：
   - "导出我的记忆"、"备份记忆"
   -> 导出记忆数据

【回复格式】
||- 成功执行："已将群提示词更新为：XXX"
||- 无法执行："抱歉，该操作暂不支持"
||- 如果用户问关于记忆的问题（如"你记得我的生日吗"），不要识别为intent_execution，而应该作为普通对话处理

根据用户输入，判断需要执行什么操作，并返回操作结果。"""

# ========================================
# 视觉AI配置 - 可选配置（用于分析图片）
# ========================================
# 配置说明：
# - 如不配置api_key，将使用dialogue的配置
[QvQChat.vision]

# OpenAI API基础URL
base_url = "https://api.openai.com/v1"

# API密钥（如不配置则使用dialogue的配置）
api_key = "sk-your-api-key-here"

# 使用的模型（建议使用支持视觉的模型）
model = "gpt-4o"

# 温度参数（建议较低温度）
temperature = 0.3

# 最大回复tokens数（图片分析不需要太长）
max_tokens = 300

# 系统提示词
system_prompt = """你是一个图片分析助手。请详细描述图片的内容，包括图片中的物体、文字、场景、人物表情等。如果有多张图片，请分别描述每张图片。"""

# ========================================
# 配置说明
# ========================================
# 1. 至少需要配置 [QvQChat.dialogue] 的 api_key
# 2. 其他AI的api_key如不配置，会自动使用dialogue的配置
# 3. 可以使用不同的API密钥，也可以共用dialogue的密钥
# 4. dialogue AI应使用支持视觉的模型（如gpt-4o），才能理解图片内容
# 5. 默认回复已设置为简短模式，无需Markdown格式，支持多消息格式
# 6. users 和 groups 配置会在运行时自动生成，无需手动配置
# 7. [QvQChat.stalker_mode] 配置群聊的窥屏行为：
#    - enabled: true 表示启用窥屏模式（默认3%回复率）
#    - 私聊不受窥屏模式影响，会积极回复
#    - 窥屏模式下即使不回复也会提取和保存记忆
# 8. AI自主判断执行：
#    - 不再需要使用 /command 格式
#    - 直接用自然语言描述操作即可（如"查一下我的记忆"、"清除会话"）
#    - intent_execution AI会智能识别并执行操作
# 9. 群记忆模式可通过自然语言切换：
#    - mixed: 混合模式（保存发送者记忆+群公共上下文）【推荐】
#    - sender_only: 仅发送者模式（只保存发送者的个人记忆）
# 10. 群聊会话历史和计数器按群共享：
#     - 所有用户在群中共享会话历史（AI能看到所有对话）
#     - 群回复限制是按群计算的，避免群内刷屏
#     - 私聊会话历史和计数器按用户独立
#
# 群配置示例（运行时自动生成，以下仅为说明）：
# [QvQChat.groups."123456789"]
#     system_prompt = "这个群是技术交流群"
#     memory_mode = "mixed"  # mixed: 混合模式, sender_only: 仅发送者模式
#     enable_memory = true
#     model_overrides = {}
