# QvQChat 配置示例
# 复制此文件为 config.toml 并填入你的API密钥

[QvQChat]
# 命令前缀（自定义，例如：/qvc 或 /ai）
command_prefix = "/qvc"

# 最大会话历史长度
max_history_length = 20

# 最小回复间隔（秒），避免频繁回复（普通群友模式）
min_reply_interval = 10

# 记忆清理间隔（秒）
memory_cleanup_interval = 86400

# 是否启用向量搜索
enable_vector_search = false

# 最大记忆tokens数
max_memory_tokens = 10000

# 记忆压缩阈值
memory_compression_threshold = 5

# 机器人昵称列表（用于文本匹配）
bot_nicknames = []

# 机器人ID列表（用于@匹配）
bot_ids = []

# ============================================
# 窥屏模式配置（群聊默默观察，偶尔活跃）
# ============================================
[QvQChat.stalker_mode]
# 是否启用窥屏模式（true=启用，false=禁用）
enabled = true

# 默认回复概率（0-1，0.03=3%）
default_probability = 0.03

# 被@时回复概率（0-1，0.8=80%）
mention_probability = 0.8

# 匹配关键词时回复概率（0-1，0.5=50%）
keyword_probability = 0.5

# 提问时回复概率（0-1，0.4=40%）
question_probability = 0.4

# 两次回复之间至少间隔多少条消息
min_messages_between_replies = 15

# 每小时最多回复次数
max_replies_per_hour = 8

# ============================================
# 回复策略配置（AI智能判断是否回复）- 已弃用，保留兼容
# ============================================
[QvQChat.reply_strategy]
# 是否自动回复（false=AI智能判断，true=按条件回复）
auto_reply = false

# 被@时是否回复（默认开启）
reply_on_mention = true

# 关键词触发列表（遇到这些词会回复）
reply_on_keyword = []

# 概率回复（0-1，0.1=10%概率）- 已弃用
reply_probability = 0.1

# 最小回复间隔（秒），避免刷屏（建议5秒）
min_reply_interval = 5

# 是否忽略命令（命令总是回复）
ignore_commands = true

# ============================================
# 对话AI配置 - 必需配置
# ============================================
[QvQChat.dialogue]
# OpenAI API基础URL（如果使用官方API，保持默认；如使用中转服务，请修改）
base_url = "https://api.openai.com/v1"

# API密钥 - 请填入你的OpenAI API密钥
api_key = "sk-your-api-key-here"

# 使用的模型（建议使用支持视觉的模型，如gpt-4o）
model = "gpt-4o"

# 温度参数（0-2，越高越随机）
temperature = 0.7

# 最大回复tokens数（简短回复建议300-500）
max_tokens = 500

# 系统提示词（简短回复，无Markdown，支持图片理解，支持多消息）
system_prompt = """你是一个普通群友，和大家一起聊天。

【重要】回复策略（像真人一样）：
- 默认保持安静，不要每条消息都回复
- 只在真正需要回应的时候说话
- 简短自然，1-2句话，不要太长
- 不要使用任何格式（不要加粗、代码、列表、标题等）
- 用口语化的方式，像真人聊天一样

【什么情况才回复】：
1. 别人直接向你提问
2. 别人@你或叫你的名字
3. 讨论到你熟悉的话题，可以发表看法
4. 看到有趣的笑话，可以配合一下
5. 之前提到的事情有新消息

【绝对不要回复】：
1. 纯打招呼（"大家好"、"在吗"）
2. 表情符号或简单的哈哈、233
3. 没什么实质内容的闲聊
4. 与你无关的话题

【多消息回复格式】：
如果你想说多句话，用这种格式：
第一句话
[间隔:3]
第二句话
[间隔:2]
第三句话

数字表示秒数，最多3条消息，每条间隔1-5秒。

【如果发送图片】：
自然地回复图片内容，不要说"这是一张图片"或类似的话。

记住：你是一个普通群友，不是助手，不要表现得太积极主动。"""

# ============================================
# 回复判断AI配置 - 智能判断是否需要回复（私聊用）
# ============================================
[QvQChat.reply_judge]
# OpenAI API基础URL
base_url = "https://api.openai.com/v1"

# API密钥（如不配置则使用dialogue的配置）
api_key = "sk-your-api-key-here"

# 使用的模型
model = "gpt-3.5-turbo"

# 温度参数（建议较低温度）
temperature = 0.1

# 最大回复tokens数
max_tokens = 100

# 系统提示词
system_prompt = """你是一个普通群友，判断是否需要回复这条消息。

【你的角色】
- 你是一个普通群友，和大家一起聊天
- 默认保持安静，只在真正需要的时候回复
- 不要每条消息都回复

【必须回复的情况】（满足任一）：
1. 有人直接向你提问（"你怎么看？"、"对吧？"）
2. 有人@你或叫你的名字
3. 话题与你直接相关（如讨论你之前提到的事）

【可能回复的情况】（根据概率判断）：
1. 别人分享有趣的事情，可以简单回应（概率低）
2. 讨论你熟悉的话题，可以发表看法（概率低）

【绝对不回复的情况】：
1. 纯打招呼（"大家好"、"在吗"、"有人吗"）
2. 表情符号、"哈哈"、"233"等
3. 简单的"嗯"、"好"、"OK"、"收到"
4. 普通闲聊，没有互动需求
5. 你刚回复过不久，避免刷屏

【判断逻辑】
- 默认不回复（false）
- 只有在明确需要回应时才回复（true）
- 宁可错过，也不要乱回复

输出格式：只回复"true"或"false"，不要解释。"""

# ============================================
# ============================================
# 记忆AI配置 - 智能记忆提取（推荐配置）
# ============================================
[QvQChat.memory]
# OpenAI API基础URL
base_url = "https://api.openai.com/v1"

# API密钥
api_key = "sk-your-api-key-here"

# 使用的模型
model = "gpt-3.5-turbo"

# 温度参数（建议中等温度）
temperature = 0.3

# 最大回复tokens数
max_tokens = 1000

# 系统提示词
system_prompt = "你是一个智能记忆提取助手，负责从对话中提取值得长期记忆的关键信息。"

# ============================================
# 查询AI配置 - 可选配置
# ============================================
[QvQChat.query]
base_url = "https://api.openai.com/v1"
api_key = "sk-your-api-key-here"
model = "gpt-3.5-turbo"
temperature = 0.3
max_tokens = 1000
system_prompt = "你是一个记忆查询助手，负责从记忆中检索相关信息。"

# ============================================
# 意图识别AI配置 - 可选配置
# ============================================
[QvQChat.intent]
# OpenAI API基础URL
base_url = "https://api.openai.com/v1"

# API密钥
api_key = "sk-your-api-key-here"

# 使用的模型
model = "gpt-3.5-turbo"

# 温度参数（建议较低温度）
temperature = 0.1

# 最大回复tokens数
max_tokens = 500

# 系统提示词
system_prompt = """你是一个意图识别助手。识别用户意图时，请仔细分析消息内容和上下文。

意图分类（选择最匹配的）：
1. dialogue - 普通对话交流（提问、聊天、日常交流）
2. memory_query - 明确要求查询历史记忆（如"我记得我昨天说过"、"查一下我之前说的"）
3. memory_add - 明确要求记住某些信息（如"记住这件事"、"记下来"、"这是重要信息"）
4. memory_delete - 明确要求删除记忆（如"忘记这件事"、"删掉这段记忆"）
5. system_control - 系统控制指令（如"切换模型"、"修改配置"、"设置风格"、"重启系统"）
6. group_config - 群聊配置相关（如"群设置"、"群提示词"、"改变群设定"、"群记忆模式"）
7. prompt_custom - 自定义提示词（如"把提示词改成..."、"换个提示词"）
8. style_change - 改变对话风格（如"变专业点"、"幽默一点"、"换个风格"）
9. export - 导出记忆（如"导出我的记忆"、"备份记忆"）

重要提示（避免误判）：
- 【严格】只有明确提及"记忆"、"查询"、"记住"、"忘记"、"删除"等关键词时才归类为memory相关意图
- 【严格】不要把普通对话误识别为记忆相关意图
- 【严格】不要把"我昨天"、"记得"等口语化表达误判为记忆查询，除非明确要求"查一下"
- 【默认】所有普通交流、提问、闲聊都归类为dialogue
- 【默认】没有明确指令的情况下，归类为dialogue

只返回意图类型名称（如dialogue），不要包含其他内容。"""

# ============================================
# 配置说明
# ============================================
# 1. 至少需要配置 [QvQChat.dialogue] 的 api_key
# 2. 其他AI的api_key可以与dialogue相同，也可以使用不同的密钥
# 3. 如果不想使用某个AI，可以将对应的api_key留空或注释掉
# 4. dialogue AI应使用支持视觉的模型（如gpt-4o），才能理解图片内容
# 5. 默认回复已设置为简短模式，无需Markdown格式，支持多消息格式
# 6. users 和 groups 配置会在运行时自动生成，无需手动配置
# 7. [QvQChat.stalker_mode] 配置群聊的窥屏行为：
#    - enabled: true 表示启用窥屏模式（默认3%回复率）
#    - 私聊不受窥屏模式影响，会积极回复
#    - 窥屏模式下即使不回复也会提取和保存记忆
# 8. 群记忆模式可通过 /group memory 命令切换：
#    - mixed: 混合模式（保存发送者记忆+群公共上下文）【推荐】
#    - sender_only: 仅发送者模式（只保存发送者的个人记忆）
#
# 群配置示例（运行时自动生成，以下仅为说明）：
# [QvQChat.groups."123456789"]
#     system_prompt = "这个群是技术交流群"
#     memory_mode = "mixed"  # mixed: 混合模式, sender_only: 仅发送者模式
#     enable_memory = true
#     model_overrides = {}
